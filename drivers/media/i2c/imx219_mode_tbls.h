/*
 * imx219_tables.h - sensor mode tables for imx219 HDR sensor.
 *
 * Copyright (c) 2015-2016, NVIDIA CORPORATION, All Rights Reserved.
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms and conditions of the GNU General Public License,
 * version 2, as published by the Free Software Foundation.
 *
 * This program is distributed in the hope it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#ifndef IMX219_I2C_TABLES
#define IMX219_I2C_TABLES

#define IMX219_TABLE_WAIT_MS 0
#define IMX219_TABLE_END 1
#define IMX219_MAX_RETRIES 3
#define IMX219_WAIT_MS 3

static struct reg_8 mode_1920x1080[] = {
	{IMX219_TABLE_WAIT_MS, 10},
	/* software reset */
	{0x0103, 0x01},
  /* make sure stream is off */
	{0x0100, 0x00},

	/* Access Code to registers over 0x3000 */
	{0x30EB, 0x05},
	{0x30EB, 0x0C},
	{0x300A, 0xFF},
	{0x300B, 0xFF},
	{0x30EB, 0x05},
	{0x30EB, 0x09},

  /* number of csi lanes = 2 (1 + 1) */
	{0x0114, 0x01},

  /* dphy control */
	{0x0128, 0x00},

  /* external clock frequency = 24MHz ?? */
	{0x012A, 0x18},
	{0x012B, 0x00},

  /* analogue gain setting */
  {0x0157, 0x00},
  /* 0x0158, 0x159 Digital gain */

  /* Course Time */
  {0x015A, 0x04},
  {0x015B, 0x22},

  /* Frame Length */
	{0x0160, 0x06},
	{0x0161, 0xE6},

  /* line length 3448 */
	{0x0162, 0x0D},
	{0x0163, 0x78},

  /* crop_rect.left */
	{0x0164, 0x02},
	{0x0165, 0xA8},

  /* crop_rect.width - 1 */
	{0x0166, 0x0A},
	{0x0167, 0x27},

  /* crop_rect.top */
	{0x0168, 0x02},
	{0x0169, 0xB4},

  /* crop_rect.height - 1 */
	{0x016A, 0x06},
	{0x016B, 0xEB},

  /* crop_rect.width */
	{0x016C, 0x07},
	{0x016D, 0x80},

  /* crop_rect.height*/
	{0x016E, 0x04},
	{0x016F, 0x38},

  /* X odd increment */
	{0x0170, 0x01},
	{0x0171, 0x01},

  /* Binning Mode */
	{0x0174, 0x00},
	{0x0175, 0x00},

  /* CSI data format */
	{0x018C, 0x0A},
	{0x018D, 0x0A},

  //Clock Settings

  /* VTPXCK_DIV */
	{0x0301, 0x05},
  /* VTSYS_DIV = 1 (Divide by 1 I think)*/
	{0x0303, 0x01},
  /* PREPLLCK_VT_DIV */
	{0x0304, 0x03},
  /* PREPLLCK_OP_DIV */
	{0x0305, 0x03},
  /* PLL_VT_MPY = 57*/
	{0x0306, 0x00},
	{0x0307, 0x39},
  /* OPPXCK_DIV */
	{0x0309, 0x0A},
  /* OPSYSCK_DIV = 1 (Divide by 1 I think) */
	{0x030B, 0x01},
  /* PLL_OP_MPY = 114*/
	{0x030C, 0x00},
	{0x030D, 0x72},

  /* CIS tunning */
  {0x455E, 0x00},
  {0x471E, 0x4B},
	{0x4767, 0x0F},
	{0x4750, 0x14},
  {0x4540, 0x00},
	{0x47B4, 0x14},
  {0x4713, 0x30},
  {0x478B, 0x10},
  {0x478F, 0x10},
  {0x4793, 0x10},
  {0x4797, 0x0E},
  {0x479B, 0x0E},

  /* Horizontal Flip */
  {0x0172, 0x01},

	/* stream on */
	{0x0100, 0x01},
	{IMX219_TABLE_WAIT_MS, IMX219_WAIT_MS},
	{IMX219_TABLE_END, 0x00}
};

static struct reg_8 mode_1280x720[] = {
	{IMX219_TABLE_WAIT_MS, 10},
	/* software reset */
	{0x0103, 0x01},

  /* stream off */
  {0x0100, 0x00},

	/* global settings */
	{0x30EB, 0x05},
	{0x30EB, 0x0C},
	{0x300A, 0xFF},
	{0x300B, 0xFF},
	{0x30EB, 0x05},
	{0x30EB, 0x09},

  /* number of csi lanes = 2 (1 + 1) */
	{0x0114, 0x01},

  /* dphy control */
	{0x0128, 0x00},

  /* external clock Frequency = 24MHz ?? */
	{0x012A, 0x18},
	{0x012B, 0x00},

  {0x0157, 0x00},
  {0x015A, 0x04},
  {0x015B, 0x22},

	/* Bank A Settings */
	{0x0160, 0x06},
	{0x0161, 0xE3},

	{0x0162, 0x0D},
	{0x0163, 0x78},

	{0x0164, 0x01},
	{0x0165, 0x68},

	{0x0166, 0x0B},
	{0x0167, 0x67},

	{0x0168, 0x02},
	{0x0169, 0x00},

	{0x016A, 0x07},
	{0x016B, 0xA1},

  /* image width = 1280 */
	{0x016C, 0x05},
	{0x016D, 0x00},

  /* image height = 720 */
	{0x016E, 0x02},
	{0x016F, 0xD0},

  /* X odd increment */
	{0x0170, 0x01},
	{0x0171, 0x01},

  /* Binning Mode */
	{0x0174, 0x01},
	{0x0175, 0x01},

  /* CSI data format */
	{0x018C, 0x0A},
	{0x018D, 0x0A},

	/* clock setting */
	{0x0301, 0x05},
	{0x0303, 0x01},
	{0x0304, 0x03},
	{0x0305, 0x03},
	{0x0306, 0x00},
	{0x0307, 0x39},
	{0x0309, 0x0A},
	{0x030B, 0x01},
	{0x030C, 0x00},
	{0x030D, 0x72},

  /* Binning ? = 1280 */
  {0x0624, 0x05},
  {0x0625, 0x00},

  /* Binning ? = 720 */
  {0x0626, 0x02},
  {0x0627, 0xD0},

	{0x455E, 0x00},
	{0x471E, 0x4B},
	{0x4767, 0x0F},
	{0x4750, 0x14},
	{0x4540, 0x00},
	{0x47B4, 0x14},
	{0x4713, 0x30},
	{0x478B, 0x10},
	{0x478F, 0x10},
	{0x4793, 0x10},
	{0x4797, 0x0E},
	{0x479B, 0x0E},

  /* Horizontal Flip */
  {0x0172, 0x01},

	/* stream on */
	{0x0100, 0x01},
	{IMX219_TABLE_WAIT_MS, IMX219_WAIT_MS},
	{IMX219_TABLE_END, 0x00}
};

static struct reg_8 mode_640x480[] = {
	{IMX219_TABLE_WAIT_MS, 10},
	/* software reset */
	{0x0103, 0x01},

  /* make sure streaming is off */
	{0x0100, 0x00},

	/* global settings */
	{0x30EB, 0x05},
	{0x30EB, 0x0C},
	{0x300A, 0xFF},
	{0x300B, 0xFF},
	{0x30EB, 0x05},
	{0x30EB, 0x09},

  /* number of csi lanes = 2 (1 + 1) */
	{0x0114, 0x01},

  /* dphy control */
	{0x0128, 0x00},

  /* external clock Frequency = 24MHz ?? */
	{0x012A, 0x18},
	{0x012B, 0x00},

	/* Bank A Settings */
	{0x0157, 0x00},
	{0x015A, 0x04},
	{0x015B, 0x22},

	{0x0160, 0x06},
	{0x0161, 0xE6},

	{0x0162, 0x0D},
	{0x0163, 0x78},

	{0x0164, 0x00},
	{0x0165, 0x00},

	{0x0166, 0x0C},
	{0x0167, 0xCF},

	{0x0168, 0x00},
	{0x0169, 0x00},

	{0x016A, 0x09},
	{0x016B, 0x9F},

	{0x016C, 0x06},
	{0x016D, 0x68},

	{0x016E, 0x04},
	{0x016F, 0xD4},

  /* X odd increment */
	{0x0170, 0x01},
	{0x0171, 0x01},

  /* Binning Mode */
	{0x0174, 0x01},
	{0x0175, 0x01},

  /* CSI data format */
	{0x018C, 0x0A},
	{0x018D, 0x0A},

	/* clock setting */
	{0x0301, 0x05},
	{0x0303, 0x01},
	{0x0304, 0x03},
	{0x0305, 0x03},
	{0x0306, 0x00},
	{0x0307, 0x39},
	{0x0309, 0x0A},
	{0x030B, 0x01},
	{0x030C, 0x00},
	{0x030D, 0x72},
	{0x455E, 0x00},
	{0x471E, 0x4B},
	{0x4767, 0x0F},
	{0x4750, 0x14},
	{0x4540, 0x00},
	{0x47B4, 0x14},
	{0x4713, 0x30},
	{0x478B, 0x10},
	{0x478F, 0x10},
	{0x4793, 0x10},
	{0x4797, 0x0E},
	{0x479B, 0x0E},

  /* horizontal flip */
	{0x0172, 0x01},

	/* stream on */
	{0x0100, 0x01},
	{IMX219_TABLE_WAIT_MS, IMX219_WAIT_MS},
	{IMX219_TABLE_END, 0x00}
};

enum {
	IMX219_MODE_1920x1080,
	IMX219_MODE_1280x720,
	IMX219_MODE_640x480,
};

static struct reg_8 *mode_table[] = {
	[IMX219_MODE_1920x1080] = mode_1920x1080,
	[IMX219_MODE_1280x720]  = mode_1280x720,
	[IMX219_MODE_640x480] = mode_640x480,
};

static const int imx219_60fps[] = {
	60,
  30,
};

static const int imx219_30fps[] = {
  30,
};


static const struct camera_common_frmfmt imx219_frmfmt[] = {
	{{1920, 1080},	imx219_30fps, 1, 0, IMX219_MODE_1920x1080 },
	{{1280,  720},	imx219_60fps, 2, 0, IMX219_MODE_1280x720  },
	{{640,   480},	imx219_60fps, 2, 0, IMX219_MODE_640x480   },
};

#endif
